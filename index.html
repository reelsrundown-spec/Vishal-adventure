<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        canvas { display: block; background: #87CEEB; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .controls { position: absolute; bottom: 10px; pointer-events: auto; display: flex; gap: 10px; }
        #l-ctrl { left: 10px; } #r-ctrl { right: 10px; }
        .btn { width: 70px; height: 70px; background: rgba(0,0,0,0.4); color: white; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        #lives { position: absolute; top: 10px; left: 10px; font-size: 30px; }
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; pointer-events: auto; }
        #msg { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; text-align: center; border-radius: 10px; z-index: 200; pointer-events: auto; }
    </style>
</head>
<body>

<div id="start-overlay">
    <button style="padding: 20px 40px; font-size: 20px; background: green; color: white; border-radius: 30px;" onclick="startGame()">START GAME</button>
</div>

<div id="msg">
    <h1 id="txt"></h1>
    <button onclick="location.reload()">വീണ്ടും കളിക്കുക</button>
</div>

<div id="ui">
    <div id="lives">❤️❤️❤️</div>
    <div id="l-ctrl" class="controls"><div class="btn" id="left">LEFT</div><div class="btn" id="right">RIGHT</div></div>
    <div id="r-ctrl" class="controls"><div class="btn" id="jump">JUMP</div></div>
</div>

<canvas id="g"></canvas>

<script>
const cvs = document.getElementById("g");
const ctx = cvs.getContext("2d");
let active = false;
let life = 3;

// Game Settings
let p = { x: 50, y: 0, r: 15, dy: 0, speed: 4 };
let hill = { x: 300, w: 100, h: 60 };
let enemy = { x: 500, w: 30, h: 50, hit: false };
let goal = { x: 800 };

function startGame() {
    document.getElementById("start-overlay").style.display = "none";
    cvs.width = window.innerWidth;
    cvs.height = window.innerHeight;
    p.y = cvs.height - 70;
    active = true;
    loop();
}

let keys = { l: false, r: false };
document.getElementById("left").ontouchstart = () => keys.l = true;
document.getElementById("left").ontouchend = () => keys.l = false;
document.getElementById("right").ontouchstart = () => keys.r = true;
document.getElementById("right").ontouchend = () => keys.r = false;
document.getElementById("jump").ontouchstart = () => { if(p.y >= cvs.height - 70) p.dy = -12; };

function loop() {
    if(!active) return;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    let ground = cvs.height - 50;

    // Draw Ground & Hill
    ctx.fillStyle = "green";
    ctx.fillRect(0, ground, cvs.width, 50);
    ctx.beginPath(); ctx.arc(hill.x, ground, 60, Math.PI, 0); ctx.fill();

    // Draw Enemy & Goal
    ctx.fillStyle = "red"; ctx.fillRect(enemy.x, ground - 50, 30, 50);
    ctx.fillStyle = "black"; ctx.fillRect(enemy.x - 5, ground - 70, 5, 40); // Bat
    ctx.fillStyle = "gold"; ctx.fillRect(goal.x, ground - 100, 20, 100);

    // Player Physics
    if(keys.l) p.x -= p.speed;
    if(keys.r) p.x += p.speed;
    p.dy += 0.6; p.y += p.dy;
    if(p.y > ground - p.r) { p.y = ground - p.r; p.dy = 0; }

    // Collision
    if(Math.abs(p.x - enemy.x) < 30 && p.y > ground - 60 && !enemy.hit) {
        life--; enemy.hit = true;
        document.getElementById("lives").innerText = "❤️".repeat(life);
        p.x -= 50; 
        setTimeout(() => enemy.hit = false, 1000);
        if(life <= 0) { active = false; showMsg("നീ തോറ്റെടാ"); }
    }

    if(p.x > goal.x) { active = false; showMsg("അടുത്ത ഘട്ടം"); }

    ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 7); ctx.fill();
    requestAnimationFrame(loop);
}

function showMsg(t) {
    document.getElementById("msg").style.display = "block";
    document.getElementById("txt").innerText = t;
}
</script>
</body>
</html>
